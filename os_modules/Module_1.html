<!DOCTYPE html>
<html lang="en">
  <head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <title>Process Manager</title>

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="../img/favicon.jpg"/>

    <!-- CSS
    ================================================== -->       
    <!-- Bootstrap css file-->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <!-- Font awesome css file-->
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <!-- Superslide css file-->
    <link rel="../stylesheet" href="css/superslides.css">
    <!-- Slick slider css file -->
    <link href="../css/slick.css" rel="stylesheet"> 
    <!-- smooth animate css file -->
    <link rel="stylesheet" href="../css/animate.css">  
    <!-- Elastic grid css file -->
    <link rel="stylesheet" href="../css/elastic_grid.css"> 
    <!-- Circle counter cdn css file -->
    <link rel='stylesheet prefetch' href='../css/jquery.circliful.css'>    
    <!-- Default Theme css file -->
    <link id="orginal" href="../css/themes/eucalyptus-theme.css" rel="stylesheet">
    <!-- Main structure css file -->
    <link href="../style.css" rel="stylesheet">
   
    <!-- Google fonts -->
    <link href='../css/opensans.css' rel='stylesheet' type='text/css'>
    <link href='../css/varela.css' rel='stylesheet' type='text/css'>
    <link href='../css/montserrat.css' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  
    <style type="text/css">
   
      pre{
       font-family: "Times new Roman"; 
       font-size: 15px;
      }
   
    </style> 

  </head>
  <body> 
     <!-- BEGAIN PRELOADER 
    <div id="preloader">
      <div id="status">&nbsp;</div>
    </div>
     END PRELOADER -->

  
    <!--=========== BEGIN HEADER SECTION ================-->
    <header id="header">
      <!-- BEGIN MENU -->
      <div class="menu_area">
        <nav class="navbar navbar-default navbar-fixed-top past-main" role="navigation"> 
          <div class="container">
          <div class="navbar-header">
            <!-- FOR MOBILE VIEW COLLAPSED BUTTON -->
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            <!-- LOGO -->

            <!-- TEXT BASED LOGO -->
            <a class="navbar-brand" href="index.html">eXpOS<span>NITC</span></a>
            
                              
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul id="top-menu" class="nav navbar-nav navbar-right main_nav">
	      <li><a href="../index.html">Home</a></li>
              <li><a href="../documentation.html" target="_blank">Documentation</a></li> 
              <li><a href="../Roadmap.html" target="_blank">Roadmap</a></li>
               <li><a href="../faq.html" target="_blank">FAQ</a></li>
              <li><a href="../About_us.html" target="_blank">About Us</a></li>                                     
            </ul>           
          </div>
          </div>     
        </nav>  
      </div>
      <!-- END MENU -->

      
    </header>
		
    <!--=========== End HEADER SECTION ================--> 
    
    <!--begin section-->
    <section id="abi" style="text-align:justify">
		<br>
		<br>
		<br>
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12">
            <div class="about_area">
             
                <!-- START ABOUT HEADING -->
              <div class="heading">
                
                <h2 > Process Manager</h2>
                <br/>
                <br/>
                
                <p> This module contains functions that manage the different aspects related to processes.
                </p>
              </div>

                 <br> <br> 




<table class="table table-bordered" style="text-align: center;">
    <tr class="success">
        <th style="text-align: center;">Function Number</th>
        <th style="text-align: center;">Function Name</th>
        <th style="text-align: center;">Arguments</th>
        <th style="text-align: center;">Return Value</th>
    </tr>


  <tr>    
    <td>GET_PCB_ENTRY = 1</td>
    <td>Get Pcb Entry</td>
    <td>NIL</td>
    <td>Index of Free PCB. </td>
  </tr>

<tr>    
    <td>FREE_USER_AREA_PAGE = 2</td>
    <td>Free User Area Page</td>
    <td>PID</td>
    <td>NIL</td>

  </tr>

<tr>    
    <td>EXIT_PROCESS = 3</td>
    <td>Exit Process</td>
    <td>PID</td>
    <td>NIL</td>
  </tr>

<tr>    
    <td>FREE_PAGE_TABLE = 4</td>
    <td>Free Page Table</td>
    <td>PID</td>
    <td>NIL</td>
  </tr>

<tr>    
    <td>KILL_ALL = 5</td>
    <td>Kill All</td>
    <td>PID</td>
    <td>NIL</td>
  </tr>

</table>
                     
                     <br><br>
                           <div style="background: url(../img/os-modules/ProcessManager.png); height: 449px; width: 981px;">

                           <a class="btn" href="Module_2.html" style="position: absolute; height: 165px; width: 270px; margin-top: 120px; margin-left: 0px"></a>
                           <a class="btn" href="Module_0.html" style="position: absolute; height: 240px; width: 270px; margin-top: 180px; margin-left: 710px"></a>
                           <a class="btn" href="Module_3.html" style="position: absolute; height: 120px; width: 270px; margin-top: 30px; margin-left: 710px"></a>
                           </div>
               
   <h3> Get PCB entry </h3>
<i> <b>Description </b></i>: Returns a Free PCB index. Returns -1 if PCB is full.<br><br>

<pre>
  loop through the <a href="../os_design-files/process_table.html">Process Table</a>{
         if ( process table entry is free )
                Set the PID to index of the entry
                Set the STATE to (ALLOCATED, - )
		Set PTBR to PAGE_TABLE_BASE + 20*index 	/* See <a href="../os_implementation.html#collapse2">Memory Organisation</a> */
		Set PTLR to 10. 						/* <a href="../abi.html">Address space</a> of processes in eXpOS has 10 pages */
		return index;
    }
    
    return -1;
</pre>

Called by Fork system call.


 <h3> Free User Area Page </h3>
   
<i> <b>Description </b></i>: Frees all the resources in the Resource Table inside the User Area page.
 Also   frees the User Area page.<br>
 <i> <b style="color:red">Note </b></i>: The function should be called only when no file/buffer/terminal resource is locked by the process.<br><br>

<pre>
   /* If the user are page is swapped out, it has to be swapped back first. */

   Get the User Area Page number from the <a href="../os_design-files/process_table.html">process table</a> entry
   corresponding to the PID;
    
    loop through the <a href="../os_design-files/process_table.html#per_process_table">Resource Table</a>{
          if ( the resource table entry is valid )
		 if (the resource is a file)
                 	Close the corresponding file by calling the Close() function in the 
		 	<a href="Module_3.html">File Manager</a> Module.
		 if (the resource is a semaphore)
                 	Release the semaphore by calling the Release Semaphore() function in the 
		 	<a href="Module_0.html">Resource Manager</a> Module.
		 Invalidate the resource table entry.
    }
    
    Free the User Area page by calling the release_page()
    function in the <a href="Module_2.html">Memory Manager</a> module;
     
    return;	
<b>Note</b>: The user area page holding the return address for the call to free_user_area_page()  
has been released! Neverthless the return address and the saved context of the calling process 
will not be lost. This is because release_page() is non blocking and hence the page will never be 
allocated to another process before control transfers back to the caller.  The calling function 
gets "time" to either invoke the scheduler using the same stack page or to reallocate the same page 
again for a different purpose.  
</pre>
Called by the exit_process function.




<h3>Exit Process</h3>
<i> <b>Description </b></i>: Terminate the process whose PID is provided.<br><br>
 <i> <b style="color:red">Note </b></i>: The function should be called only when no file/terminal/disk/buffer resource is locked by the process.<br><br>


<pre>

    <b>if</b> (the current process is not in the exec system call)	// check MODE_FLAG
    {
    	<b>loop</b> though the <a href="../os_design-files/process_table.html">process table</a> entries
	{
    		/* Wake up all processes waiting for the current process */
    		<b>if</b>( process is waitng for the current process ) 		/* indicated by the STATE = (WAIT_PROCESS, PID ) */
			Set STATE of the process to (READY, - )
		/* Set the children of the process as Orphan */
		<b>if</b>( process has PPID as that of the current process)
			Set PPID to -1.
        }
    }

    Free the <a href="../os_design-files/process_table.html#per_page_table">Page Table</a> entry corresponding to the process by
    invoking the Free_Page_Table() function; 
    
    Free the User Area Page corresponding to the process by calling
    the Free_User_Area_Page() function;  
    /* After the User Area Page has been deallocated, the process is executing without a kernel stack.
       Hence the process should immmediately be scehduled out */
    
    Set the state of process as (TERMINATED , - )

    return;
    /* Note that the return statement is executing using a deallocated stack page. See note after free_user_area_page() */ 
</pre>

Called by exec system call, exit system call, exception handler, shutdown and logout.

<h4>Question:</h4>
<p>1. Why is the loop in the beginning not executed when called from exec system call?</p> 


<h3> Free Page Table </h3>
<i> <b>Description </b></i>: Free the page table entry and the used pages. The Disk Map table entries are also freed.<br><br>

<pre>
    Invalidate the <a href="../os_design-files/process_table.html#per_page_table">page table</a> entries corresponding to the shared library pages;
    
    loop through the other <a href="../os_design-files/process_table.html">page table</a> entries{
    	  if ( the entry is valid ){
              free the corresponding page by 
              invoking the release_page() function 
              in the <a href="./Module_2.html">Memory Manager module</a>;
          }
          Invalidate the page table entry;
    }

    Loop through the <a href="../os_design-files/process_table.html">Disk Map Table</a> entries of the process  
    	if (the entry is valid and is stack or heap)
	    call release_block() function in the <a href="Module_2.html">Memory Manager</a> Module.
        set the entry to -1.
    return;
</pre>

Called by the exit_process function.

   <h3>Kill All</h3>
<i> <b>Description </b></i>: Kills all the processes except the current process, idle and init/<font color="red">login*</font>.<br><br>

<pre>
/* Lock all files to ensure that no processes are in the middle of a file operation */
<b>For</b> each valid entry in the <a href="../os_design-files/disk_ds.html#inode_table">Inode table</a>	
	Acquire lock on the file by calling the <b>acquire_inode()</b> function in the <a href="Module_0.html">Resource Manager</a> module.

<b>For</b> each pid from 2 to MAX_PROC_NUM - 1 	/* PID 0 is idle and 1 is init */
{
    <a data-toggle="collapse" href="#collapse1">/* This code is relevant only when the Pager Module is implemented in Stage 27 */</a>
    <div id="collapse1" class="panel-collapse collapse">    <b>If</b> pid == PID of Swapper Daemon         /* Swapper Daemon must not be TERMINATED */
          continue;</div>
    <b>If</b> pid != pid of the current process AND state of the process in the process table entry is not TERMINATED
	  Call <b>exit_process()</b> function from the <a href="Module_1.html">Process Manager</a> Module.
}

<b>For</b> each valid entry in the Inode table
	Release lock on the file by calling the <b>release_inode()</b> function in the Resource Manager module.

return;
</pre>

Called by shutdown and logout system call.
<br>
*The init process will be the login process in the multi user extension of eXpOS


                     <!--end-->   

<br> <br>
<!-- 

****  NOTE - If necessary add a duplicate_process function to copy the stack and open resources and stack. 
            This will make the fork sm call less lenghty.
-->
                    
                               </div>
              </div>
            </div>
          </div>
        </div>       
      </div>
       	
		 
    </section>
    
    <!--end section-->
                
 <!--=========== BEGIN FOOTER ================-->
     <footer id="footer">
       <div class="container">
         <div class="row">
<a style="float: right" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="../img/creativecommons.png" /></a>
           <div class="col-lg-6 col-md-6 col-sm-6">
             <div class="footer_left">
               <p><a href="http://www.nitc.ac.in/">National Institute of Technology, Calicut</a></p>
             </div>
           </div>
         </div>
       </div>
      </footer>
      <!--=========== END FOOTER ================-->

     <!-- Javascript Files
     ================================================== -->
  
     <!-- initialize jQuery Library -->
    <script src="../js/jquery.min.js"></script>
    <!-- Google map -->
    <script src="../js/map_js.js"></script>
    <script src="../js/jquery.ui.map.js"></script>
     <!-- For smooth animatin  -->
    <script src="../js/wow.min.js"></script> 
    <!-- Bootstrap js -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- superslides slider -->
    <script src="../js/jquery.superslides.min.js" type="text/javascript"></script>
    <!-- slick slider -->
    <script src="../js/slick.min.js"></script>    
    <!-- for circle counter -->
    <script src='../js/jquery.circliful.min.js'></script>
    <!-- for portfolio filter gallery -->
    <script src="../js/modernizr.custom.js"></script>
    <script src="../js/classie.js"></script>
    <script src="../js/elastic_grid.min.js"></script>
    <script src="../js/portfolio_slider.js"></script>

    <!-- Custom js-->
    <script src="../js/custom.js"></script>
  </body>
</html>
